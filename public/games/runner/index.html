<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, user-scalable=no"
    />
    <title>Tiny Runner</title>
    <style>
      html,
      body {
        margin: 0;
        height: 100%;
        background: #101010;
        overflow: hidden;
      }
      canvas {
        display: block;
        width: 100vw;
        height: 100vh;
        background: #1d1d1d;
      }
    </style>
  </head>
  <body>
    <canvas id="c"></canvas>
    <script>
      const c = document.getElementById('c');
      const x = c.getContext('2d');
      function R() {
        c.width = innerWidth;
        c.height = innerHeight;
      }
      addEventListener('resize', R);
      R();

      let g = 0.7,
        ground = c.height * 0.8,
        speed = 6;
      let p = { x: c.width * 0.2, y: ground, v: 0, jumping: false };
      let obs = [],
        t = 0,
        run = true,
        score = 0;

      function jump() {
        if (!p.jumping) {
          p.v = -14;
          p.jumping = true;
        }
      }
      addEventListener('pointerdown', jump);
      addEventListener('keydown', (e) => {
        if (e.code === 'Space') jump();
      });

      function spawn() {
        const h = 30 + Math.random() * 50;
        obs.push({
          x: c.width + 40,
          y: ground - h,
          w: 20 + Math.random() * 30,
          h,
        });
      }

      function loop() {
        t++;
        if (run) {
          p.v += g;
          p.y += p.v;
          if (p.y >= ground) {
            p.y = ground;
            p.jumping = false;
          }
          if (t % 70 === 0) spawn();
        }

        x.clearRect(0, 0, c.width, c.height);

        // ground line
        x.fillStyle = '#2a2a2a';
        x.fillRect(0, ground + 8, c.width, 4);

        // obstacles
        x.fillStyle = '#27c';
        for (let i = obs.length - 1; i >= 0; i--) {
          const o = obs[i];
          if (run) o.x -= speed;
          x.fillRect(o.x, o.y, o.w, o.h);
          // collision
          if (
            p.x < o.x + o.w &&
            p.x + 24 > o.x &&
            p.y < o.y + o.h &&
            p.y + 24 > o.y
          )
            run = false;
          if (o.x + o.w < 0) {
            obs.splice(i, 1);
            score++;
          }
        }

        // player
        x.fillStyle = '#eee';
        x.fillRect(p.x, p.y - 24, 24, 24);

        // score
        x.fillStyle = '#fff';
        x.font = '20px system-ui';
        x.fillText('Score: ' + score, 12, 28);

        if (!run) {
          x.fillText('Game Over â€” tap to retry', 12, 54);
          try {
            parent.postMessage({ type: 'gameover', id: 'runner', score }, '*');
          } catch (e) {}
          addEventListener(
            'pointerdown',
            () => {
              obs = [];
              t = 0;
              run = true;
              score = 0;
              p = { ...p, y: ground, v: 0, jumping: false };
            },
            { once: true }
          );
        }

        requestAnimationFrame(loop);
      }
      loop();
    </script>
  </body>
</html>
